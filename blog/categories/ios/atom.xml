<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: iOS | Traximus‘pages]]></title>
  <link href="http://traximus.github.io/blog/categories/ios/atom.xml" rel="self"/>
  <link href="http://traximus.github.io/"/>
  <updated>2014-04-14T18:53:49+08:00</updated>
  <id>http://traximus.github.io/</id>
  <author>
    <name><![CDATA[traximus]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[关于64下的int和NSInteger转换]]></title>
    <link href="http://traximus.github.io/blog/2014/04/02/guan-yu-64xia-de-inthe-nsintegerzhuan-huan/"/>
    <updated>2014-04-02T17:22:51+08:00</updated>
    <id>http://traximus.github.io/blog/2014/04/02/guan-yu-64xia-de-inthe-nsintegerzhuan-huan</id>
    <content type="html"><![CDATA[<h3>发发牢骚</h3>

<blockquote><p>之前做了一个项目，和我们自己服务器交互的时候，私有协议会然后一个状态码，标识当前操作的状态。app去解析这个状态码，然后把网络字节序转换成本地字节序，解读状态码，进行相应的操作。本来这个过程很简单，之前测试也一直没有出过任何错误。但是今天各种调试通不过，花了很长时间才发现，他妈的居然是32位和64位的兼容性问题。NSInteger修改为int，问题立马消失了。</p></blockquote>

<hr />

<p>之前一直使用NSInteger接收4字节bytes，然后转换字节序，一切正常；今天测试的时候，发现服务器返回的字节流<code>FFFF FFFF FFFF FFFE</code>，转换后应该是-2，但是死活不对。一问，发现服务器端没有修改过，我这边也没有动过，怎么会这样呢？</p>

<h3>然后开始做实验</h3>

<p>```
1. NSInteger testN1 = -2;
   NSData *testData1 = [NSData dataWithBytes:&amp;testN1 length:4];
   [GlobalAddtions printDetailData:testData1];</p>

<p>   打印结果： FEFF FFFF FFFF FFFF</p>

<ol>
<li><p>NSInteger testN2 = htonl(testN1);
NSData *testData2 = [NSData dataWithBytes:&amp;testN2 length:4];
[GlobalAddtions printDetailData:testData2];
打印结果： FFFF FFFF FFFF FFFE</p>

<p>打印出原字节流，发现也是 FFFF FFFF FFFF FFFE</p>

<p>那么，按理说，这个转换应该就是没有问题的。</p></li>
</ol>


<p>```</p>

<h3>于是，继续做实验</h3>

<p>```
1. NSInteger testN3;
   [testData2 getBytes:&amp;testN3 length:4];
   NSLog(@&ldquo;%d&rdquo;,testN3);</p>

<p>   按照理解，testData2的字节流，就是服务器发送过来，转换以后的字节流，那么，转回去应该就为-2；</p>

<p>   但是，经过打印测试，testN3居然不等于testN2</p>

<ol>
<li><p>NSInteger testN4 = ntohl(testN3);
NSLog(@&ldquo;%d&rdquo;,testN4);</p>

<p>这里打印，testN4也不等于-2
```</p></li>
</ol>


<p><em>但是，明明所有的字节流打印出来都是没错的，这是为什么呢？</em></p>
]]></content>
  </entry>
  
</feed>
